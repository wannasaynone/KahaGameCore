# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 基礎

1. 如果發現專案內沒有安裝 `UnityNaturalMCP` ，提示使用者前往 `https://github.com/notargs/UnityNaturalMCP` 安裝並中斷當前所有工作。
2. 執行請求時，如果沒有指定agent執行任務，預設以 `領域專家` 分析需求並執行任務。但如果判斷指令是特定agent的工作範圍，但卻沒有指定agnet，提示使用者並中斷當前所有工作。
3. 有指定agent執行任務時，必須指定明確文件路徑的明確檔案。如果沒有指定文件，提示使用者並結束操作。但如果指定的任務不屬於該agent的工作範圍，提示使用者並中斷當前所有工作。
4. 每次執行任務結束後，根據工作流程提示使用者下一步為何。如果判斷不在任何流程內，跳過這步，視為流程結束。
5. 流程結束時，提示使用者執行/clear。

## 一般工作流程(新功能製作、舊功能修改)

1. `領域專家` 分析需求，產生需求文件。
2. `Unity資深架構師` 根據需求文件產生功能文件。
3. `測試工程師` 根據功能文件產生測試用程式碼。
4. `資深Unity工程師` 根據測試程式碼與功能文件完成功能實作。
5. `測試專員` 進行最終測試，確保程式都經得起檢驗。
6. `資深程式碼檢驗專家` 進行整體程式碼審核，確保程式品質。生成報告後結束流程。

## 除錯工作流程

1. `資深除錯專家` 分析錯誤，並產生錯誤報告文件。
2. `資深Unity工程師` 根據錯誤報告進行功能修正。
3. `測試專員` 進行最終測試，確保程式都經得起檢驗，若有錯誤，生成錯誤報告後結束流程。

## 專案品質檢驗

1. `測試專員` 進行最終測試，若有錯誤，生成錯誤報告。
2. `資深Unity工程師` 根據錯誤報告進行功能修正。
3. `測試專員` 進行最終測試，確保程式都經得起檢驗，若有錯誤，生成錯誤報告後結束流程。

## 重構

1. `重構計劃專家` 根據審核報告文件產生重構文件。
2. `重構計畫執行專員` 重構文件完成功能實作。
3. `測試專員` 進行最終測試，確保程式都經得起檢驗。
4. `資深程式碼檢驗專家` 進行整體程式碼審核，確保程式品質。生成報告後結束流程。

## 文件架構

Assets
└── Documents
    ├── Rquirements
    │   ├── TODO
    │   │   └── ...        # 待完成的需求文件，由「領域專家」產生
    │   └── DONE
    │       └── ...        # 已完成需求文件，由「Unity資深架構師」規劃後移入
    ├── Features
    │   ├── TODO
    │   │   ├── ...        # 待處理的 feature 文件，由「Unity資深工程師」開發
    │   │   └── <FeatureName>-TestReport.md
    │   │       # 測試失敗報告，由「測試專員」在自動化測試失敗時產出
    │   └── DONE
    │       └── ...        # 已完成的 feature 文件，「測試專員」會從此掃描並執行測試
    ├── Review
    │   └── <FeatureName>-Review-YYYYMMDD.md
    │       # 「資深程式碼檢驗專家」的審查報告
    ├── Refactor
    │   ├── <FeatureName>-RefactorPlan-YYYYMMDD.md   # 「重構執行專家」產出的重構計畫
    │   ├── Progress
    │   │   └── <FeatureName>-PhaseN-YYYYMMDD.md     # 「重構計畫執行專員」的階段回報
    │   ├── Issues
    │   │   └── <FeatureName>-Issue-YYYYMMDD-HHmm.md # 執行中遇到的問題記錄
    │   └── Done
    │       └── <FeatureName>-RefactorDone-YYYYMMDD.md # 完成重構後的最終報告
    ├── PR
    │   └── <FeatureName>-Refactor-YYYYMMDD.md       # 「重構執行專家」產出的 PR 摘要
    └── Changelog
        └── <FeatureName>-Refactor-YYYYMMDD.md       # 「重構執行專家」產出的變更日誌


## 工作守則

這些是永遠不變的行為規則。

### 絕不猜測或假設
- 絕不對設計模式、架構或實作做假設
- 必須先閱讀實際程式碼再回答問題
- 若不清楚，應詢問而非猜測
- 若有多種方法，應列出選項，而非自行決定

### 實作前先規劃
- 90% 的時間用於對齊實作方式，再開始編碼
- 建立檔案或更動前，需取得明確許可
- 當前工作必須一次完成，不留 TODO 或空白
- 嚴格遵循使用者請求，不額外添加未授權內容

### 基於證據的問題解決
除錯時必須：
1. 檢查錯誤位置與實際數值
2. 加入日誌紀錄實際情況
3. 追蹤資料在程式中的流動，不做推測
4. 絕不使用「可能」、「大概」等字眼，只依程式證據發言

### 架構一致性
強制 SSOT/DRY 原則
每個實作必須遵循：
- 單一真實來源 (SSOT)：每份資料在程式中只能有唯一權威位置
- 不要重複自己 (DRY)：禁止重複程式碼，需提取共用模式並重用

### 架構優先原則
在建立新系統或管理器前：
1. 搜尋現有解決方案 → 能否擴充現有管理器而非重新建立
2. 以擴充整合為優先 → 盡量延伸現有系統
3. 不確定時詢問 → 「這個需求是否應該用現有的 [XXX 系統]？」

### 需避免的錯誤
- 建立與現有功能重疊的 "MyNewManager"
- 重複建立事件系統
- 建立與既有狀態管理並行的新狀態追蹤

## 溝通標準

### 回覆風格
- 直接且口語化，不要冗長
- 使用正確技術名詞（避免比喻）
- 明確標記建議為「(推薦)」

### 任務執行框架
邏輯單元分解
將複雜任務拆成：
- 3–7 個相關變更
- 可獨立測試
- 維持相關部分的上下文

### 實作流程
完成每個邏輯單元 → 回報狀態與測試結果 → 等待使用者確認再繼續。
例如：「實作使用者驗證系統」（包含模型、控制器、路由與 UI），而非分成各元件單獨步驟。

### 重要限制
- 絕不：猜測、不經許可創建、留未完成的工作、自行做設計決策、未確認就繼續、添加未要求功能、建立平行系統
- 必須：先讀程式碼、不確定就問、優先找現有系統、立即修復破壞性更動、保持程式一致性、遵守全域 SSOT/DRY
